########### Coding for Colombia Dataset #############

#!/bin/bash

#Colombia dataset requires manifest file, also demultiplexes samples
#importing demultiplexed sequences while in the directory: /home/qiime2/data/colombia
#as a file named demux_seqs.qza
qiime tools import \
> --type "SampleData[SequencesWithQuality]" \
> --input-format SingleEndFastqManifestPhred33V2 \
> --input-path /mnt/datasets/project_2/colombia/colombia_manifest.txt \
> --output-path ./demux_seqs.qza

#making a visualization file to view the interactive quality plot on the qiime2 view website
#necessary for denoising step
qiime demux summarize \
> --i-data demux_seqs.qza \
> --o-visualization demux_seqs.qzv

#using a Phred score of 30 as the threshold (99.9% base call accuracy) and looking at the interactive quality plot,
#we do not trim anything on the left, and trim at 230 bases on the right

#started working in a screen called qiime_colombia

#determining ASVs using DADA2
#AND denoising
qiime dada2 denoise-single \
  --i-demultiplexed-seqs demux_seqs.qza \
  --p-trim-left 0 \
  --p-trunc-len 230 \
  --o-representative-sequences rep-seqs.qza \
  --o-table table.qza \
  --o-denoising-stats stats.qza

#visualizing DADA2 stats
qiime metadata tabulate \
  --m-input-file stats.qza \
  --o-visualization stats.qzv

#visualizing ASV stats
qiime feature-table summarize \
  --i-table table.qza \
  --o-visualization table.qzv \
  --m-sample-metadata-file /mnt/datasets/project_2/colombia/colombia_metadata.txt

qiime feature-table tabulate-seqs \
  --i-data rep-seqs.qza \
  --o-visualization rep-seqs.qzv
